<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>WebSocket Lobby</title>
<style>
  body {
    background:#111;
    color:#fff;
    font-family:Arial;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
  }
  #box {
    background:#222;
    padding:20px;
    width:320px;
    border-radius:8px;
  }
  input, button {
    width:100%;
    padding:8px;
    margin-top:8px;
  }
</style>
</head>
<body>

<div id="box">
  <div id="login">
    <h2>Join Lobby</h2>
    <input id="username" placeholder="Username">
    <button id="joinBtn">Join</button>
  </div>

  <div id="lobby" style="display:none;">
    <h2>Lobby</h2>
    <ul id="players"></ul>
  </div>
</div>

<script>
const players = new Map();
let ws;
let username;

document.getElementById("joinBtn").onclick = () => {
  username = document.getElementById("username").value.trim();
  if (!username) return alert("Enter a username");

const replotUrl = "wss://@Zapt0rWut/idk.replit.dev"; // Replace with your actual Replit URL
ws = new WebSocket(replotUrl);

  ws.onmessage = (e) => {
    const msg = JSON.parse(e.data);

    if (msg.event === "join") {
      players.set(msg.data, true);
    }

    if (msg.event === "leave") {
      players.delete(msg.data);
    }

    render();
  };

  ws.onclose = () => {
    players.clear();
    render();
  };

  document.getElementById("login").style.display = "none";
  document.getElementById("lobby").style.display = "block";
};

function send(event, data) {
  ws.send(JSON.stringify({ event, data }));
}

function render() {
  const ul = document.getElementById("players");
  ul.innerHTML = "";
  players.forEach((_, name) => {
    const li = document.createElement("li");
    li.textContent = name;
    ul.appendChild(li);
  });
}

window.addEventListener("beforeunload", () => {
  if (ws && ws.readyState === WebSocket.OPEN) {
    send("leave", username);
  }
});
</script>

</body>
</html>
